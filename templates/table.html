<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sistema de Registro de Clientes — Registros</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
<aside class="sidebar">
<span class="brand">Sistema de Registro de Clientes</span>
<a href="{{ url_for('home') }}">Novo cadastro</a>
<a href="{{ url_for('table') }}">Ver registros</a>
<a href="{{ url_for('excluidos') }}">Ver excluídos</a>
</aside>
<main class="main">
<div class="card">
<h1>Registros</h1>

{% if rows is none and tables is not none %}
    <h2>Tabelas disponíveis</h2>
    <p>Clique em uma tabela para visualizar seus registros:</p>
    <div class="office-links">
    {% for t in tables %}
        <a href="{{ url_for('table', office=t) }}">{{ t }}</a>
    {% endfor %}
    </div>
{% elif rows is not none and office_name is not none %}

    <div class="row" style="justify-content:space-between;align-items:center;">
        <h2>Escritório: {{ office_name }} ({{ rows|length }} registros)</h2>
        <div>
            <a class="btn ghost" href="{{ url_for('export_csv', office=office_name) }}">Exportar CSV - {{ office_name }}</a>
            <a class="btn ghost" href="{{ url_for('export_pdf', office=office_name) }}" target="_blank">Exportar PDF - {{ office_name }}</a>
            <a class="btn ghost" href="{{ url_for('export_pdf', office='all') }}" target="_blank" style="margin-left: 8px;">Exportar PDF - Todas</a>
        </div>
    </div>
    
    <div class="row" style="margin-top: 12px;">
        <label><input id="select-all" type="checkbox"> Selecionar todos</label>
        <form id="bulk-delete-form" action="{{ url_for('delete_selected') }}" method="post" data-confirm="true" data-confirm-message="Deseja realmente excluir os registros selecionados? (Eles serão movidos para a lixeira)">
            <input type="hidden" name="ids" id="bulk-ids">
            <input type="hidden" name="table" value="office_{{ office_name }}">
            <button class="btn" type="submit">Excluir selecionados</button>
        </form>
    </div>

    <div class="table-wrap">
        <form id="table-form" action="{{ url_for('delete_selected') }}" method="post">
        <input type="hidden" name="table" value="office_{{ office_name }}">
        <table>
            <thead>
                <tr>
                    <th>Sel.</th>
                    <th>ID</th>
                    <th>Nome</th>
                    <th>CPF</th>
                    <th>Escritório</th>
                    <th>Tipo de ação</th>
                    <th>Data Fechamento</th>
                    <th>Pendências</th>
                    <th>Processo</th>
                    <th>Data Protocolo</th>
                    <th>Captador</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for r in rows %}
                <tr>
                    <td><input type="checkbox" class="row-select" name="row_id" value="{{ r['id'] }}"></td>
                    <td>{{ r['id'] }}</td>
                    <td>{{ r['nome'] }}</td>
                    <td>{{ r['cpf'] }}</td>
                    <td>{{ r['escritorio'] }}</td>
                    <td>{{ r['tipo_acao'] }}</td>
                    <td>{{ r['data_fechamento'] }}</td>
                    <td>{{ r['pendencias'] }}</td>
                    <td>{{ r['numero_processo'] }}</td>
                    <td>{{ r['data_protocolo'] }}</td>
                    <td>{{ r['captador'] }}</td>
                    <td>
                        <form action="{{ url_for('delete_single') }}" method="post" style="display:inline" data-confirm="true" data-confirm-message="Deseja realmente excluir este cliente? (Será movido para a lixeira)">
                            <input type="hidden" name="id" value="{{ r['id'] }}">
                            <input type="hidden" name="table" value="office_{{ office_name }}">
                            <button class="btn ghost" type="submit">Excluir</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </form>
    </div>

{% else %}
    <p>Nenhum registro encontrado para o escritório **{{ office_name }}**.</p>
{% endif %}

</div>
</main>
</div>
<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
