<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Sistema de Registro de Clientes — Registros</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
<aside class="sidebar">
<span class="brand">Sistema de Registro de Clientes</span>
<a href="{{ url_for('index') }}">Novo cadastro</a>
<a href="{{ url_for('table') }}">Ver registros</a>
<a href="{{ url_for('excluidos') }}">Ver excluídos</a>
</aside>
<main class="main">
<div class="card">
<h1>Registros</h1>

<div class="row" style="margin-bottom:12px;">
  <form action="{{ url_for('table') }}" method="get">
    <label>Filtrar por escritório:</label>
    <select name="office" onchange="this.form.submit()">
      {% for office_option in offices %}
        <option value="{{ office_option }}" {% if office_option == office %}selected{% endif %}>{{ office_option }}</option>
      {% endfor %}
    </select>
  </form>
</div>

<div class="row" style="justify-content:space-between;align-items:center;">
  <div class="row" style="gap:12px">
    <label><input id="select-all" type="checkbox"> Selecionar todos</label>
    <button class="btn" id="btn-delete-selected" type="button">Excluir selecionados</button>
  </div>
  <div>
    <a class="btn ghost" href="{{ url_for('export_csv', office=office) }}">Exportar CSV - {{ office }}</a>
    <a class="btn ghost" href="{{ url_for('export_pdf', office=office) }}" target="_blank">Exportar PDF - {{ office }}</a>
    <a class="btn ghost" href="{{ url_for('export_csv', office='all') }}">Exportar CSV - Todas</a>
    <a class="btn ghost" href="{{ url_for('export_pdf', office='all') }}" target="_blank">Exportar PDF - Todas</a>
  </div>
</div>

<div class="table-wrap" style="margin-top:12px;">
<input type="hidden" name="office_name" value="{{ office }}">
<table>
<thead>
  <tr>
    <th></th> <th>id</th>
    <th>nome</th>
    <th>cpf</th>
    <th>escritorio</th>
    <th>tipo_acao</th>
    <th>data_fechamento</th>
    <th>pendencias</th>
    <th>numero_processo</th>
    <th>data_protocolo</th>
    <th>observacoes</th>
    <th>captador</th>
    <th>created_at</th>
    <th>Ações</th>
  </tr>
</thead>
<tbody>
{% for r in rows %}
<tr>
  <td><input type="checkbox" class="row-select" value="{{ r['id'] }}"></td>
  <td>{{ r['id'] }}</td>
  <td>{{ r['nome'] }}</td>
  <td>{{ r['cpf'] }}</td>
  <td>{{ r['escritorio'] }}</td>
  <td>{{ r['tipo_acao'] }}</td>
  <td>{{ r['data_fechamento'] }}</td>
  <td>{{ r['pendencias'] }}</td>
  <td>{{ r['numero_processo'] }}</td>
  <td>{{ r['data_protocolo'] }}</td>
  <td>{{ r['observacoes'] }}</td>
  <td>{{ r['captador'] }}</td>
  <td>{{ r['created_at'] }}</td>
  <td>
    <form action="{{ url_for('delete_record') }}" method="post" style="display:inline" data-confirm="true" data-confirm-message="Deseja realmente excluir este cliente?">
      <input type="hidden" name="id" value="{{ r['id'] }}">
      <input type="hidden" name="table" value="{{ office }}">
      <button class="btn ghost" type="submit">Excluir</button>
    </form>
  </td>
</tr>
{% endfor %}
</tbody>
</table>
</div>

</div>
</main>
</div>
<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
